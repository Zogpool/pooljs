/*! CoinsForAll - 2016-11-02 */
!function(a,b){"use strict";var c=function(){var a=b.createElement("transitionTest"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var d in c)if(void 0!==a.style[d])return c[d]}();a.oneTransitionEnd=function(b,d){if(c){b=b[0]||b;var e=function(){d(),b.removeEventListener(c,e,!1)};b.addEventListener(c,e,!1)}else a.setTimeout(d,0)}}(window,document),Pool.portal=angular.module("pool.portal",["ngRoute","pool.api","pool.async","pool.static","pool.url","pool.utils","pool.view"]).config(["$routeProvider","$locationProvider",function(a,b){function c(a){return Pool.TMPL_ROOT+a+".html"}b.hashPrefix("!"),a.when("/",{templateUrl:c("pool"),name:"pool",controller:"PoolCtrl"}).when("/coin/:code",{templateUrl:c("coin"),name:"coin",controller:"CoinCtrl"}).when("/coin/:code/wallet/:user",{templateUrl:c("wallet"),name:"wallet",controller:"WalletCtrl"}).otherwise({redirectTo:"/"})}]).run(["view",function(a){a.defaultParam("coins",Pool.coins||[])}]),Pool.portal.controller("CoinCtrl",["$scope","view","api","utils",function(a,b,c,d){function e(){return c.getPoolStats(b.code.toLowerCase()).then(function(b){a.stat=b},g)}function f(d,e){var f=!!arguments.length;return c.getCoinBlocks(b.code.toLowerCase(),null,{heightFrom:d,hashFrom:e,count:a.limit}).then(function(b){a.blocks=f?a.blocks.concat(b):b},g)}function g(b){b&&a.$message.error(b,k)}function h(){f(),e()}var i=6e4,j=d.repeat(i,h),k=15e3;a.limit=20,a.calculate=function(){a.openInfoDialog("Coming soon...")},a.account=function(a){b.go("wallet",{code:b.code,user:a})},a.showMoreBlocks=function(){var b=a.blocks;if(b&&b.length){var c=b[b.length-1];j.stop(),f(c.height,c.hash).finally(function(){j.start(i)})}},a.getTemplateUrl=function(a){return Pool.TMPL_ROOT+[b.code.toLowerCase(),a].join("-")+".html"},a.$on("$routeChangeStart",function(){j.stop()}),j.start()}]),Pool.portal.controller("MainCtrl",["$scope","view","utils",function(a,b,c){function d(b,c){c&&a.dialog.open("message",{message:c.toString(),type:b||"error"})}a.view=b,a.openErrorDialog=angular.bind(this,d,"error"),a.openInfoDialog=angular.bind(this,d,"info"),a.onChangeCoinEventClick=function(a){a&&b.go("coin",{code:a.code})},a.$on("$routeChangeSuccess",function(a,d,e){b.defaultParam("coin",c.findElement(b.coins,{code:b.code}))})}]),Pool.portal.controller("MessageCtrl",["$scope","dialog","message","type",function(a,b,c,d){a.message=c,a.type=d,a.ok=b.ok}]),Pool.portal.controller("PoolCtrl",["$scope","view","api",function(a,b,c){}]),Pool.portal.controller("WalletCtrl",["$scope","$filter","view","api","utils",function(a,b,c,d,e){function f(){return d.getUserInfo(c.code.toLowerCase(),null,{userId:c.user}).then(function(c){a.info=c,a.settings.minimalPayout=c?b("satoshi")(c.minimalPayout):void 0},i)}function g(){return d.getUserStats(c.code.toLowerCase(),null,{userId:c.user}).then(function(b){a.stats=b?b.total:void 0,a.workers=b?b.workers:[]},i)}function h(b){var e=!!arguments.length;return d.getUserPayments(c.code.toLowerCase(),null,{userId:c.user,timeFrom:b,count:a.limit}).then(function(b){a.payments=e?a.payments.concat(b):b},i)}function i(b){b&&a.$message.error(b,m)}function j(){f(),h(),g()}var k=6e4,l=e.repeat(k,j),m=15e3,n=5e3;a.limit=20,a.settings={},a.saveSettings=function(b){var e=a.form&&a.form.settings;e&&!e.$invalid&&(e.$setPristine(),d.saveUserSettings(c.code.toLowerCase(),null,{userId:c.user,minimalPayout:1e8*b.minimalPayout}).then(function(){a.$message.info("Settings saved successfully",n),f()},function(a){e.$setDirty(),i(a)}))},a.payout=function(b){b&&d.payout(c.code.toLowerCase(),null,{userId:c.user}).then(function(){a.$message.info("Payment request has been sent",n)},i)},a.showMorePayments=function(){var b=a.payments;if(b&&b.length){var c=b[b.length-1];l.stop(),h(c.time).finally(function(){l.start(k)})}},a.$on("$routeChangeStart",function(){l.stop()}),l.start()}]),Pool.portal.directive("appMessage",function(){var a,b="active";return function(c,d,e){function f(){clearTimeout(a),d.removeClass(b),h.unbind("click",f)}function g(e,g,j){g?(d.removeClass(Object.keys(c.$message).join(" ")),d.addClass(e),i.text(g),h.bind("click",f),d.hasClass(b)?clearTimeout(a):d.addClass(b),j&&(a=setTimeout(f,j))):f()}d.html('<button type="button" class="close">&times;</button><div class="text"/>');var h=d.find("button"),i=d.find("div");c.$on("$routeChangeStart",f),c.$message={primary:angular.bind(this,g,"primary"),success:angular.bind(this,g,"success"),info:angular.bind(this,g,"info"),warning:angular.bind(this,g,"warning"),error:angular.bind(this,g,"error")}}}),Pool.portal.directive("popupContainer",["$q","$compile","$controller","$log","async","static",function(a,b,c,d,e,f){function g(g,h){function i(a){void 0===p&&(p=h.html()),h.append(a),h.css("display","block"),h.attr("tabindex","1000"),h[0].focus();var b=h.children();return k(b,"reset").bind("click",function(a){this.disabled||n("reject"),a.stopPropagation()}),k(b,"submit").bind("click",function(a){this.disabled||n("resolve"),a.stopPropagation()}),b.bind("click",function(a){a.stopPropagation()}),b}function j(){if(o&&void 0!==p){var a=o.node;k(a,"reset").unbind(),k(a,"submit").unbind(),a.unbind(),h.html(p)}h.css("display","none"),h.removeAttr("tabindex")}function k(a,b){for(var c=angular.element(),d=a.find("button"),e=0;e<d.length;e++)angular.element(d[e]).attr("type")==b&&c.push(d[e]);return c}function l(a){if(o)for(var b=k(o.node,a),c=0;c<b.length;c++)if(!b[c].disabled)return!0;return!1}function m(c,d){return f.tmpl(c).then(function(c){return o={node:i(c),locals:d||{},result:a.defer()},h.addClass("open"),b(h.contents())(g),o.result.promise})}function n(a,b){!o&&d.warn("Popup double hiding");var c=o.result;return o.scope&&o.scope.$destroy(),h.removeClass("open"),oneTransitionEnd(o.node,function(){j(),o=null,e[a](b,c)}),c.promise}var o,p;h.bind("click",function(a){l("reset")&&n("reject")}),h.bind("keyup",function(a){if(27==a.which&&l("reset")){var b=o.node.attr("escape-confirm");if(b&&!confirm(b))return;n("reject")}else 13==a.which&&l("submit")&&n("resolve")}),g.$on("$destroy",function(){h.unbind()}),g.$on("$routeChangeStart",function(){o&&(d.warn("Changing route with popup opened"),n("reject"))}),j(),this.open=function(a,b){return o?n("reject").then(null,function(){return m(a,b)}):m(a,b)},this.close=this.cancel=function(a){return o?n("reject",a):(d.warn("Rejecting popup when not opened"),e.reject())},this.ok=function(a){return o?n("resolve",a):(d.warn("Resolving popup when not opened"),e.resolve())},this.controller=function(a,b){if(o){if(o.scope)throw Error("Multiple popup-contorllers not allowed");return o.locals.dialog=this,o.scope=o.locals.$scope=b,c(a,o.locals)}}}return{controller:["$scope","$element",g],link:function(a,b,c,d){c.popupContainer&&(a[c.popupContainer]=d)}}}]).directive("popupController",["$compile",function(a){return{require:"^popupContainer",compile:function(b,c){var d=a(b.contents());return function(a,b,c,e){if(c.popupController){a=a.$new(!0);var f=e.controller(c.popupController,a);b.contents().data("$ngControllerController",f)}d(a)}}}}]),Pool.portal.directive("appStopEvent",function(){var a=["stopPropagation","preventDefault"];return function(b,c,d){var e=d.methods?d.methods.split(","):a;c.bind(d.appStopEvent,function(a){for(var b=e.length;b--;)a[e[b].trim()]()})}}),Pool.portal.directive("appTemplate",function(){return{restrict:"A",replace:!0,templateUrl:function(a,b){return Pool.TMPL_ROOT+b.appTemplate+".html"}}}),Pool.portal.directive("appToggle",["$document",function(a){var b=void 0;return function(c,d,e){function f(d){d&&a.unbind("click",f),b&&c.$apply(function(){c[b]=b=void 0})}d.bind("click",function(d){d.preventDefault(),d.stopPropagation(),c.$apply(function(){c[e.appToggle]=!c.$eval(e.appToggle)}),angular.isUndefined(e.autoclose)||(b&&b!==e.appToggle&&f(!0),c[e.appToggle]&&(b=e.appToggle,a.bind("click",f)))})}}]),Pool.portal.filter("join",function(){return function(a,b){return a=a.filter(function(a){return!(null==a||0===a.length)}),a.join(b)}}),Pool.portal.filter("power",function(){return function(a,b){switch(b?b.type:void 0){case"CPD":case"MHS":case"SOLS":return[angular.isNumber(a)?a/1e3:a,b.name].join(" ");default:return a}}}),Pool.portal.filter("satoshi",function(){return function(a){return angular.isNumber(a)?a/1e8:a}}),Pool.portal.filter("unixDate",["$filter",function(a){return function(b,c,d){return angular.isNumber(b)?a("date")(1e3*b,c||"yyyy-MM-dd HH:mm:ss",d):b}}]),Pool.portal.filter("url",["url",function(a){return function(b,c){return angular.isString(b)?a.interpolate(b,c):b}}]),Pool.portal.filter("view",["view",function(a){return a.href}]),angular.module("pool.api",["pool.url"]).factory("api",["$http","$log","url",function(a,b,c){function d(c,d,e,f){return a({method:c,url:d,data:e,params:f}).then(function(a){return a.data},function(a){throw b.error("Server error",a.status,a.data),a.data})}function e(a,b){function e(b,c,f){return d(a,e.url(b),c,f)}var f={};return e.url=function(a,d){var e=angular.isObject(d)?Object.keys(d).filter(function(a){return d[a]}):[];return Pool.API_ROOT+c.interpolate(b,a)+(e.length?"?"+c.param(d):"")},e.cached=function(b,g,h){var i=[c.param(b,!0),h?c.param(h):void 0].join("?");return f[i]=f[i]||d(a,e.url(b),g,h),f[i]},e.cache_clean=function(){f={}},e}return{getPoolStats:e("GET",":code/poolStats"),getCoinBlocks:e("GET",":code/foundBlocks"),getUserInfo:e("GET",":code/clientInfo"),getUserStats:e("GET",":code/clientStats"),getUserPayments:e("GET",":code/payouts"),saveUserSettings:e("POST",":code/settings"),payout:e("POST",":code/payout")}}]),angular.module("pool.async",[]).factory("async",["$q","$rootScope","$log",function(a,b,c){function d(a){setTimeout(function(){a(),b.$$phase?c.error("Timeout in digest cycle"):b.$apply()},0)}function e(b,c,e){return e||(c&&angular.isFunction(c.resolve)?(e=c,c=void 0):e=a.defer()),d(function(){e[b](c)}),e.promise}return{resolve:angular.bind(this,e,"resolve"),reject:angular.bind(this,e,"reject"),notify:angular.bind(this,e,"notify")}}]),angular.module("pool.static",["pool.async"]).factory("static",["$http","$q","$templateCache","async",function(a,b,c,d){function e(a,b){var c,d=document.createElement("script"),e=i.getElementsByTagName("script")[0];d.src=a,d.onreadystatechange=d.onload=function(){c||d.readyState&&!/loaded|complete/.test(d.readyState)||(c=!0,d.onload=d.onreadystatechange=null,b())},e?i.insertBefore(d,e):i.appendChild(d)}function f(a,b,c){return c||(c=b,b=null),a+c+(b||"")}function g(a){function c(a){if(j.script[a])return d.resolve();var f=b.defer();return e(c.url(a),function(){j.script[a]=!0,d.resolve(f)}),f.promise}return c.url=angular.bind(this,f,a,".js"),c}function h(b,c,e){function g(b){var c=g.url(b),f=e&&e.get(c);return f?d.resolve(f[1]):a.get(c,{cache:e}).then(function(a){return a.data})}return g.url=angular.bind(this,f,b,c),g}var i=document.getElementsByTagName("head")[0],j=Pool.portal.cache=Pool.portal.cache||{script:{}};return{include:h(Pool.INCLUDE_ROOT),tmpl:h(Pool.TMPL_ROOT,".html",c),script:g(Pool.SCRIPT_ROOT)}}]),angular.module("pool.url",[]).factory("url",function(){return{interpolate:function(a,b){function c(a,b,c){return b?angular.isDefined(a)?a+(c||""):"":a}var d,b=angular.copy(b);return angular.isObject(b)||(b=[b]),angular.isArray(b)?d=function(a,d,e,f){return c(b.shift(),e,f)}:angular.isObject(b)&&(d=function(a,d,e,f){return c(b[d],e,f)}),a.replace(/:(\w+)(\?(\/)?)?/g,d)},param:function(a,b){var c=[];return angular.isObject(a)?angular.isArray(a)||b?angular.forEach(a,function(a){c.push(encodeURIComponent(a))}):angular.forEach(a,function(a,b){c.push(b+"="+encodeURIComponent(a))}):c.push(encodeURIComponent(a)),c.join("&")}}}),angular.module("pool.utils",[]).service("utils",["$q",function(a){function b(a,b){this.delay=a,this.func=b,this.callback=function(a){return a},this.errback=function(a){return a},this._timeoutId=null,this._promise=null}function c(a,b,c,e){return b==a._promise?(a._promise=null,d(a,a.delay),a[c](e)):null}function d(b,d){b._timeoutId=setTimeout(function(){b._timeoutId=null;var d=a.defer(),e=b._promise=d.promise.then(function(a){return c(b,e,"callback",a)},function(a){return c(b,e,"errback",a)});d.resolve(b.func())},d)}b.prototype={start:function(a,b){return b=b||this.func,a=a||0,(b!=this.func||this._timeoutId||a>0&&this._promise)&&(this.stop(),this.func=b),!(!angular.isFunction(this.func)||0==a&&this._promise)&&(d(this,a),!0)},stop:function(){this._promise?this._promise=null:this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},state:function(){return this._promise?"EXECUTED":this._timeoutId?"PENDING":"STOPPED"},then:function(a,b){this.callback=angular.isFunction(a)?a:angular.noop,this.errback=angular.isFunction(b)?a:angular.noop}},this.repeat=function(a,c){return new b(a,c)},this.dehydrate=function(a,b){var c=this,d=angular.isArray(a)?[]:{};return angular.forEach(a,function(a,e){angular.isNumber(e)?d[e]=c.dehydrate.call(c,a,b):b.indexOf(e)!=-1&&(d[e]=angular.copy(a))}),d},this.extracted=function(a){if(!angular.isObject(a))return a;var b={};return angular.forEach(a,function(a,c){"$"!==c.charAt(0)&&null!=a&&""!==a&&(b[c]=angular.copy(a))}),b},this.findElement=function(a,b){if(angular.isArray(a))for(var c=Object.keys(b||{}),d=a.length;d--;)if(angular.equals(this.dehydrate(a[d],c),b))return a[d]}}]),angular.module("pool.view",["pool.url"]).factory("view",["$route","$rootScope","$location","url",function(a,b,c,d){function e(a,b){return d.interpolate(h[a]||i,b)}var f,g,h={},i=a.routes[null],j={},k=function(){var a=function(){};return a.prototype=j,new a}();return i=i?i.redirectTo:"/",angular.forEach(a.routes,function(a,b){a.name&&(h[a.name]=b)}),b.$on("$routeChangeSuccess",function(a,b){j.name=b.name,j.area=j.name&&j.name.split("-",1)[0],!f||angular.isArray(f)?angular.copy(b.params,k):f!=k&&angular.copy(f,k),f=null,b.historyOff||(g=c.path())}),j.href=function(a,b){return Pool.URL_PREFIX+e(a,b)},j.previous=function(a){f=a,c.path(g)},j.go=function(a,b){f=b,c.path(e(a,b))},j.defaultParam=function(a,b){return angular.isUndefined(b)?j[a]:j[a]=b},k}]);